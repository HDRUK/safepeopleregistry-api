# docker/Caddyfile

{
    # Global options for Caddy
    # Direct Caddy to use /tmp for its persistent storage.
    # This is crucial for ephemeral environments like Google Cloud Run.
    storage file_system {
        root /tmp/caddy_data 
    }

    # Optionally, configure Caddy's own logging to stdout/stderr
    # so it's captured by Google Cloud Logging.
    log {
        output file /dev/stderr # Send Caddy logs to stderr
        level INFO               # Set desired log level
    }
}

# Your main site block. 
# Cloud Run injects the listening port via the $PORT environment variable.
# Your Dockerfile exposes 8100, so we'll use that as the default for FrankenPHP.
:{$PORT} {
    # Serve Laravel application with FrankenPHP
    root /var/www/public
    frankenphp {
        # Point to your Laravel public/index.php for the worker script
        worker /var/www/public/index.php
        # You can add other FrankenPHP worker options here if needed, 
        # e.g., num, env, etc.
    }

    # Enable the file server for static assets (CSS, JS, images)
    file_server
}